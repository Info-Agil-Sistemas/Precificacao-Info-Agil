name: Deploy to Vercel

on:
  push:
    branches: [ main ]

jobs:
  check-config:
    runs-on: ubuntu-latest
    outputs:
      has-secrets: ${{ steps.check-secrets.outputs.has-secrets }}
    steps:
    - name: Check if secrets are configured
      id: check-secrets
      run: |
        if [[ -n "${{ secrets.VERCEL_TOKEN }}" && -n "${{ secrets.PROJECT_ID }}" && -n "${{ secrets.ORG_ID }}" ]]; then
          echo "has-secrets=true" >> $GITHUB_OUTPUT
        else
          echo "has-secrets=false" >> $GITHUB_OUTPUT
        fi

  deploy:
    needs: check-config
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout c√≥digo
      uses: actions/checkout@v4
      
    - name: Instru√ß√µes para primeiro deploy
      if: needs.check-config.outputs.has-secrets == 'false'
      run: |
        echo "üöÄ PRIMEIRO DEPLOY - Configura√ß√£o necess√°ria:"
        echo ""
        echo "1Ô∏è‚É£ Acesse https://vercel.com"
        echo "2Ô∏è‚É£ Fa√ßa login com sua conta GitHub"
        echo "3Ô∏è‚É£ Clique 'New Project'"
        echo "4Ô∏è‚É£ Selecione o reposit√≥rio 'Precificacao-Info-Agil'"
        echo "5Ô∏è‚É£ Configure:"
        echo "   - Framework: Other"
        echo "   - Build Command: (deixe vazio)"
        echo "   - Output Directory: ./"
        echo "6Ô∏è‚É£ Clique 'Deploy'"
        echo ""
        echo "üìã Arquivo principal: saas_pricing_calculator_v3.html"
        echo "üìñ Guia completo: Veja SETUP-VERCEL.md no reposit√≥rio"
        echo ""
        echo "‚ö†Ô∏è Ap√≥s o primeiro deploy, configure os secrets no GitHub para deploy autom√°tico"
        
    - name: Deploy autom√°tico
      if: needs.check-config.outputs.has-secrets == 'true'
      uses: amondnet/vercel-action@v25
      with:
        vercel-token: ${{ secrets.VERCEL_TOKEN }}
        vercel-org-id: ${{ secrets.ORG_ID }}
        vercel-project-id: ${{ secrets.PROJECT_ID }}
        vercel-args: '--prod'
