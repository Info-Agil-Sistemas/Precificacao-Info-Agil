<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Calculadora de Precifica√ß√£o SaaS ‚Äî Info √Ågil v3</title>
  <style>
    :root {
      --bg1:#0f172a; --bg2:#111827;
      --card:#0b1220; --muted:#9ca3af;
      --brand:#22d3ee; --brand2:#7c3aed;
      --ok:#22c55e; --warn:#f59e0b; --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1000px 500px at 10% 0%, var(--bg1), var(--bg2));
      color:#e5e7eb; padding:22px;
    }
    .wrap{max-width:1200px; margin:0 auto;}
    .hero{padding:20px 16px 8px; text-align:center}
    .hero h1{margin:0 0 8px;font-size:clamp(22px,3vw,36px); font-weight:700; letter-spacing:.2px}
    .hero p{margin:0; color:var(--muted)}
    .grid{display:grid; gap:16px; grid-template-columns: 1fr 1fr;}
    @media (max-width: 900px){ .grid{grid-template-columns:1fr;} }
    .card{background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:18px; box-shadow: 0 10px 30px rgba(0,0,0,.25)}
    h2{font-size:18px; margin:0 0 14px; font-weight:700; color:#fff}
    .subtle{color:var(--muted); font-size:13px}
    label{display:block; font-size:13px; color:#cbd5e1; margin:10px 0 6px}
    input[type="number"]{
      width:100%; background:#0a0f1a; color:#e5e7eb; border:1px solid rgba(255,255,255,.12);
      border-radius:10px; padding:10px 12px; font-size:14px; outline:none;
    }
    input[type="number"]:focus{border-color:var(--brand)}
    .row{display:grid; grid-template-columns: repeat(2,minmax(0,1fr)); gap:10px}
    .row3{display:grid; grid-template-columns: repeat(3,minmax(0,1fr)); gap:10px}
    .row5{display:grid; grid-template-columns: repeat(5,minmax(0,1fr)); gap:10px}
    .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    button{
      border:0; padding:10px 14px; border-radius:10px; cursor:pointer; color:#0b1220; font-weight:700;
      background: linear-gradient(135deg, var(--brand), var(--brand2));
    }
    .ghost{background:transparent; color:#e5e7eb; border:1px solid rgba(255,255,255,.16)}
    .cards{display:grid; grid-template-columns: repeat(5,minmax(0,1fr)); gap:10px}
    @media (max-width: 1100px){ .cards{grid-template-columns: repeat(2,minmax(0,1fr));} }
    @media (max-width: 600px){ .cards{grid-template-columns: 1fr;} }
    .pricing{background:linear-gradient(135deg, rgba(34,211,238,.08), rgba(124,58,237,.08)); border:1px solid rgba(34,211,238,.25)}
    .price{font-size:26px; font-weight:800; margin:4px 0 8px}
    .mut{color:var(--muted); font-size:12px}
    .metric-grid{display:grid; grid-template-columns: repeat(6,minmax(0,1fr)); gap:10px; margin-top:12px}
    @media (max-width: 1100px){ .metric-grid{grid-template-columns: repeat(2,minmax(0,1fr));} }
    .metric{background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.1); border-radius:12px; padding:12px}
    .metric .val{font-size:20px; font-weight:800}
    .badge{display:inline-block; padding:4px 8px; border-radius:999px; font-size:12px; font-weight:700}
    .b-ok{background:rgba(34,197,94,.15); color:#22c55e; border:1px solid rgba(34,197,94,.35)}
    .b-warn{background:rgba(245,158,11,.15); color:#f59e0b; border:1px solid rgba(245,158,11,.35)}
    .b-dang{background:rgba(239,68,68,.15); color:#ef4444; border:1px solid rgba(239,68,68,.35)}
    table{width:100%; border-collapse:collapse; font-size:13px}
    th,td{padding:8px 6px; border-bottom:1px dashed rgba(255,255,255,.08)}
    .pill{display:inline-block; padding:4px 8px; border-radius:999px; font-size:12px}
    .p-high{background:rgba(34,197,94,.15); color:#22c55e}
    .p-med{background:rgba(245,158,11,.15); color:#f59e0b}
    .p-low{background:rgba(239,68,68,.15); color:#ef4444}
    .hint{font-size:12px;color:var(--muted)}
    .right{text-align:right}
    .center{text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <h1>üí∞ Calculadora de Precifica√ß√£o SaaS ‚Äî Info √Ågil (White Label + Pr√≥prio)</h1>
      <p class="subtle">Ajuste custos, taxas e margens. A calculadora usa o custo base Avante + % White Label sobre receita e entrega m√©tricas SaaS (MRR, LTV, Break-even, LTV/CAC).</p>
    </div>

    <div class="grid">
      <section class="card">
        <h2>üìä Custos Fixos Mensais</h2>
        <div class="row">
          <div>
            <label>Contador (R$)</label>
            <input id="contador" type="number" min="0" step="50" value="800"/>
          </div>
          <div>
            <label>Marketing Digital (R$)</label>
            <input id="marketing" type="number" min="0" step="100" value="2000"/>
          </div>
        </div>
        <div class="row">
          <div>
            <label>VPS + Infra (R$)</label>
            <input id="infraestrutura" type="number" min="0" step="50" value="800"/>
          </div>
          <div>
            <label>Dom√≠nios + Certificados (R$)</label>
            <input id="dominios" type="number" min="0" step="10" value="300"/>
          </div>
        </div>
        <div class="row">
          <div>
            <label>Telefone + Internet (R$)</label>
            <input id="comunicacao" type="number" min="0" step="10" value="250"/>
          </div>
          <div>
            <label>Pr√≥-labore (R$)</label>
            <input id="prolabore" type="number" min="0" step="100" value="4000"/>
          </div>
        </div>
        <div class="row">
          <div>
            <label>Outros Custos (R$)</label>
            <input id="outros" type="number" min="0" step="50" value="350"/>
          </div>
          <div>
            <label>Setup Avante ‚Äî amortiza√ß√£o (R$ 9.500 / 12)</label>
            <input id="setupAvante" type="number" min="0" step="50" value="9500"/>
          </div>
        </div>
      </section>

      <section class="card">
        <h2>üéØ Par√¢metros</h2>

        <div class="row">
          <div>
            <label>Margem de Lucro Desejada (%)</label>
            <input id="margemLucro" type="number" min="0" max="100" step="1" value="40"/>
          </div>
          <div>
            <label>Meta de Clientes (m√™s 12)</label>
            <input id="metaClientes" type="number" min="1" step="1" value="120"/>
          </div>
        </div>

        <label>Distribui√ß√£o de Planos (%)</label>
        <div class="row5">
          <div><label class="hint">MEI</label><input id="distribMei" type="number" min="0" max="100" step="1" value="15"/></div>
          <div><label class="hint">Contador</label><input id="distribContador" type="number" min="0" max="100" step="1" value="20"/></div>
          <div><label class="hint">B√°sico</label><input id="distribBasico" type="number" min="0" max="100" step="1" value="30"/></div>
          <div><label class="hint">Inter</label><input id="distribInter" type="number" min="0" max="100" step="1" value="25"/></div>
          <div><label class="hint">Premium</label><input id="distribPremium" type="number" min="0" max="100" step="1" value="10"/></div>
        </div>

        <div class="row">
          <div>
            <label>Churn Rate Estimado (%/m√™s)</label>
            <input id="churnRate" type="number" min="0" max="50" step="0.1" value="4"/>
          </div>
          <div>
            <label>CAC ‚Äî Custo de Aquisi√ß√£o (R$)</label>
            <input id="cac" type="number" min="0" step="10" value="200"/>
          </div>
        </div>

        <div class="row">
          <div>
            <label>Impostos (% sobre pre√ßo)</label>
            <input id="impostos" type="number" min="0" max="50" step="0.5" value="8.5"/>
          </div>
          <div>
            <label>Comiss√µes (% sobre pre√ßo)</label>
            <input id="comissoes" type="number" min="0" max="30" step="0.5" value="7"/>
          </div>
        </div>

        <div class="row">
          <div>
            <label>White Label ‚Äî Avante (% sobre receita)</label>
            <input id="whiteLabelPct" type="number" min="0" max="100" step="1" value="30"/>
          </div>
          <div>
            <label>Suporte (R$/cliente/m√™s)</label>
            <input id="suporte" type="number" min="0" step="5" value="35"/>
          </div>
        </div>

        <div class="actions">
          <button onclick="calcular()">üîÑ Calcular Pre√ßos</button>
          <button class="ghost" onclick="exportarJSON()">üì§ Exportar JSON</button>
        </div>
      </section>
    </div>

    <section class="card pricing" style="margin-top:16px">
      <h2>üíé Precifica√ß√£o Recomendada</h2>
      <div class="subtle" style="margin-bottom:10px">
        F√≥rmula: <code>P = (Custo Direto / (1 - Margem)) / (1 - Impostos - Comiss√µes - WhiteLabel)</code>
      </div>
      <div class="cards" id="cards"></div>

      <div class="metric-grid">
        <div class="metric"><div class="val" id="mrrTotal">R$ 0</div><div class="subtle">MRR Projetado</div></div>
        <div class="metric"><div class="val" id="custosFixosTotal">R$ 0</div><div class="subtle">Custos Fixos</div></div>
        <div class="metric"><div class="val" id="breakEven">0</div><div class="subtle">Break-even (clientes)</div></div>
        <div class="metric"><div class="val" id="ltv">R$ 0</div><div class="subtle">LTV M√©dio</div></div>
        <div class="metric"><div class="val" id="ltvCacRatio">0x</div><div class="subtle">LTV/CAC</div></div>
        <div class="metric"><div class="val" id="receitaAnual">R$ 0</div><div class="subtle">Receita Anual</div></div>
      </div>
    </section>

    <section class="card" style="margin-top:16px">
      <h2>üéÅ Cat√°logo de Adicionais ‚Äî Upsell</h2>
      <p class="subtle">Os pre√ßos sugeridos abaixo aplicam a <b>margem de adicionais</b> definida aqui.</p>
      <div class="row">
        <div>
          <label>Margem sobre Adicionais (%)</label>
          <input id="margemAdicionais" type="number" min="0" max="200" step="1" value="50"/>
        </div>
        <div>
          <label>Ades√£o m√©dia (para m√©tricas) ‚Äî Muito/Moderado/Opcional</label>
          <div class="row3">
            <input id="txMuito" type="number" min="0" max="100" step="1" value="70"/>
            <input id="txMod" type="number" min="0" max="100" step="1" value="40"/>
            <input id="txOpc" type="number" min="0" max="100" step="1" value="20"/>
          </div>
        </div>
      </div>

      <div class="row3" id="addonsTables"></div>

      <div class="metric-grid" style="margin-top:10px">
        <div class="metric"><div class="val" id="receitaAdicionaisMensal">R$ 0</div><div class="subtle">Receita Mensal ‚Äî Adicionais</div></div>
        <div class="metric"><div class="val" id="margemAdicionaisMensal">R$ 0</div><div class="subtle">Margem ‚Äî Adicionais</div></div>
        <div class="metric"><div class="val" id="ticketMedioComAdicionais">R$ 0</div><div class="subtle">Ticket M√©dio com Adicionais</div></div>
      </div>
    </section>
  </div>

  <script>
    const custosAvanteBase = { mei:25, contador:30, basico:36, inter:56, premium:130 };

    const adicionaisRaw = [
      // Muito recomendado
      {nome:"WhatsApp",     custo:20,   tipo:"muito"},
      {nome:"Boleto",       custo:25,   tipo:"muito"},
      {nome:"Integra√ß√£o Pix",custo:17,  tipo:"muito"},
      {nome:"Assinador",    custo:25,   tipo:"muito"},
      {nome:"For√ßa de Vendas", custo:15,tipo:"muito"},

      // Moderado
      {nome:"Contrato",     custo:30,   tipo:"moderado"},
      {nome:"Lote",         custo:25,   tipo:"moderado"},
      {nome:"SEUPOS",       custo:20,   tipo:"moderado"},
      {nome:"Averba√ß√£o",    custo:18,   tipo:"moderado"},
      {nome:"Promo√ß√£o",     custo:20,   tipo:"moderado"},

      // Opcional
      {nome:"TEF Sitef",    custo:130,  tipo:"opcional"},
      {nome:"TEF Adicional",custo:32,   tipo:"opcional"},
      {nome:"SEUPOS + STONE", custo:25, tipo:"opcional"},
      {nome:"Card√°pio Digital", custo:15, tipo:"opcional"},
      {nome:"Declara√ß√£o de Importa√ß√£o", custo:20, tipo:"opcional"}
    ];

    function money(v){ return "R$ " + Math.round(v).toLocaleString("pt-BR"); }

    function getInputs(){
      const v = (id)=> parseFloat(document.getElementById(id).value);
      const custoFixo = {
        contador: v('contador'),
        marketing: v('marketing'),
        infraestrutura: v('infraestrutura'),
        dominios: v('dominios'),
        comunicacao: v('comunicacao'),
        prolabore: v('prolabore'),
        outros: v('outros'),
        setupAvante: v('setupAvante')/12
      };
      const parametros = {
        margemLucro: v('margemLucro')/100,
        metaClientes: v('metaClientes'),
        distribMei: v('distribMei')/100,
        distribContador: v('distribContador')/100,
        distribBasico: v('distribBasico')/100,
        distribInter: v('distribInter')/100,
        distribPremium: v('distribPremium')/100,
        churnRate: v('churnRate')/100,
        cac: v('cac'),
        impostos: v('impostos')/100,
        comissoes: v('comissoes')/100,
        whiteLabelPct: v('whiteLabelPct')/100,
        suporte: v('suporte'),
        margemAdicionais: v('margemAdicionais')/100,
        txMuito: v('txMuito')/100,
        txMod: v('txMod')/100,
        txOpc: v('txOpc')/100
      };
      return {custoFixo, parametros};
    }

    function calcularPrecoPlano(custoAvante, custoFixoTotal, p){
      const custoFixoPorCliente = custoFixoTotal / p.metaClientes;
      const custoDireto = custoAvante + custoFixoPorCliente + p.suporte;
      const percSobrePreco = p.impostos + p.comissoes + p.whiteLabelPct;
      const preco = (custoDireto / (1 - p.margemLucro)) / (1 - percSobrePreco);
      const margem = preco - custoDireto - (preco * (p.impostos + p.comissoes + p.whiteLabelPct));
      const roi = margem / (custoDireto || 1);
      return { preco: Math.round(preco), custoDireto: Math.round(custoDireto), margem: Math.round(margem), roi: Math.round(roi*100) };
    }

    function desenharCards(res){
      const map = [
        {k:'mei', titulo:'üë∂ MEI', base:custosAvanteBase.mei},
        {k:'contador', titulo:'üìä Contador', base:custosAvanteBase.contador},
        {k:'basico', titulo:'üì¶ B√°sico', base:custosAvanteBase.basico},
        {k:'inter', titulo:'‚ö° Intermedi√°rio', base:custosAvanteBase.inter},
        {k:'premium', titulo:'üöÄ Premium', base:custosAvanteBase.premium},
      ];
      const el = document.getElementById('cards');
      el.innerHTML = '';
      map.forEach(({k,titulo,base}) => {
        const i = res.planos[k];
        const html = `
          <div class="card">
            <div class="mut">Custo Avante: ${money(base)}/m√™s</div>
            <div class="price">${money(i.preco)}</div>
            <div class="mut">${titulo}</div>
            <table style="margin-top:6px">
              <tr><td>Margem</td><td class="right">${money(i.margem)}</td></tr>
              <tr><td>ROI</td><td class="right">${i.roi}%</td></tr>
              <tr><td>Custo Direto</td><td class="right">${money(i.custoDireto)}</td></tr>
            </table>
          </div>`;
        el.insertAdjacentHTML('beforeend', html);
      });
    }

    function tabelaAddons(id, titulo, filtro, corClass){
      const {parametros} = getInputs();
      const itens = adicionaisRaw.filter(a => a.tipo===filtro).map(a => {
        const venda = Math.round(a.custo * (1 + parametros.margemAdicionais));
        return {...a, venda};
      });
      const tHead = `<tr><th class="left">Adicional</th><th class="right">Custo</th><th class="right">Pre√ßo sugerido</th></tr>`;
      const rows = itens.map(it => `<tr>
        <td>${it.nome}</td>
        <td class="right">${money(it.custo)}</td>
        <td class="right"><b>${money(it.venda)}</b></td>
      </tr>`).join('');
      const badge = filtro==='muito' ? '<span class="badge b-ok">Muito recomendado</span>' :
                    filtro==='moderado' ? '<span class="badge b-warn">Moderado</span>' :
                    '<span class="badge b-dang">Opcional</span>';
      const html = `
        <div class="card">
          <h3 style="margin:0 0 6px">${titulo} ${badge}</h3>
          <table>${tHead}${rows}</table>
        </div>`;
      document.getElementById(id).insertAdjacentHTML('beforeend', html);
      return itens;
    }

    let dadosCalculados = {};

    function calcular(){
      const {custoFixo, parametros} = getInputs();
      const custoFixoTotal = Object.values(custoFixo).reduce((a,b)=>a+b,0);

      // planos
      const planos = {};
      planos.mei = calcularPrecoPlano(custosAvanteBase.mei, custoFixoTotal, parametros);
      planos.contador = calcularPrecoPlano(custosAvanteBase.contador, custoFixoTotal, parametros);
      planos.basico = calcularPrecoPlano(custosAvanteBase.basico, custoFixoTotal, parametros);
      planos.inter = calcularPrecoPlano(custosAvanteBase.inter, custoFixoTotal, parametros);
      planos.premium = calcularPrecoPlano(custosAvanteBase.premium, custoFixoTotal, parametros);

      // distribui√ß√£o clientes
      const cMei = parametros.metaClientes * parametros.distribMei;
      const cCont = parametros.metaClientes * parametros.distribContador;
      const cBas = parametros.metaClientes * parametros.distribBasico;
      const cInt = parametros.metaClientes * parametros.distribInter;
      const cPre = parametros.metaClientes * parametros.distribPremium;

      // MRR dos planos
      const mrrPlanos = (cMei*planos.mei.preco) + (cCont*planos.contador.preco) + (cBas*planos.basico.preco) + (cInt*planos.inter.preco) + (cPre*planos.premium.preco);

      // Addons (pre√ßo sugerido com margem)
      const container = document.getElementById('addonsTables'); container.innerHTML='';
      const addMuito = tabelaAddons('addonsTables','Pack ‚Äî Muito Recomendado','muito');
      const addMod   = tabelaAddons('addonsTables','Pack ‚Äî Moderado','moderado');
      const addOpc   = tabelaAddons('addonsTables','Pack ‚Äî Opcional','opcional');

      // m√©dias por categoria para proje√ß√£o (itens/cliente)
      const mediaVenda = arr => arr.reduce((s,i)=>s+i.venda,0)/arr.length;
      const mediaCusto = arr => arr.reduce((s,i)=>s+i.custo,0)/arr.length;

      const mediaV_M = mediaVenda(addMuito), mediaV_m = mediaVenda(addMod), mediaV_o = mediaVenda(addOpc);
      const mediaC_M = mediaCusto(addMuito), mediaC_m = mediaCusto(addMod), mediaC_o = mediaCusto(addOpc);

      // suposi√ß√µes de quantidade de itens/cliente por categoria
      const itens_M = 1.5, itens_m = 1.0, itens_o = 0.5;

      const receitaAdicionais = (parametros.metaClientes * parametros.txMuito * mediaV_M * itens_M) +
                                (parametros.metaClientes * parametros.txMod   * mediaV_m * itens_m) +
                                (parametros.metaClientes * parametros.txOpc   * mediaV_o * itens_o);

      const custoAdicionais   = (parametros.metaClientes * parametros.txMuito * mediaC_M * itens_M) +
                                (parametros.metaClientes * parametros.txMod   * mediaC_m * itens_m) +
                                (parametros.metaClientes * parametros.txOpc   * mediaC_o * itens_o);

      const margemAdd = receitaAdicionais - custoAdicionais;

      const mrrTotal = mrrPlanos + receitaAdicionais;
      const ticketMedio = mrrTotal / Math.max(1,parametros.metaClientes);
      const ltv = ticketMedio * (1/Math.max(0.0001,parametros.churnRate)) * 12;
      const ltvCac = ltv / Math.max(1,parametros.cac);
      const breakEven = Math.ceil(custoFixoTotal / Math.max(1,ticketMedio));

      // atualizar UI
      desenharCards({planos});
      document.getElementById('mrrTotal').textContent = money(mrrTotal);
      document.getElementById('custosFixosTotal').textContent = money(custoFixoTotal);
      document.getElementById('breakEven').textContent = breakEven;
      document.getElementById('ltv').textContent = money(ltv);
      document.getElementById('ltvCacRatio').textContent = Math.round(ltvCac) + "x";
      document.getElementById('receitaAnual').textContent = money(mrrTotal*12);

      document.getElementById('receitaAdicionaisMensal').textContent = money(receitaAdicionais);
      document.getElementById('margemAdicionaisMensal').textContent = money(margemAdd);
      document.getElementById('ticketMedioComAdicionais').textContent = money(ticketMedio);

      // salvar estrutura para exporta√ß√£o
      dadosCalculados = {
        inputs: { custoFixo, parametros },
        planos,
        metricas: { mrrPlanos, receitaAdicionais, mrrTotal, ticketMedio, ltv, ltvCac, breakEven, custoFixoTotal },
        adicionais: {
          muito: addMuito,
          moderado: addMod,
          opcional: addOpc,
          suposicoes: { itens_M, itens_m, itens_o }
        }
      };
    }

    function exportarJSON(){
      if(!Object.keys(dadosCalculados).length){ alert("Calcule primeiro."); return; }
      const blob = new Blob([JSON.stringify(dadosCalculados,null,2)], {type:"application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "precificacao_saas_infoagil.json";
      a.click();
      setTimeout(()=>URL.revokeObjectURL(a.href), 2000);
    }

    window.addEventListener("load", ()=>{
      calcular();
      document.addEventListener("input", (e)=>{
        if(e.target && e.target.tagName === "INPUT"){ calcular(); }
      });
    });
  </script>
</body>
</html>
